@startuml

autonumber

"Massage Controller" -> "In-Vehicle Digital Twin Service": FindByModel("dtmi:sdv:Vehicle;1") - request

"Massage Controller" <- "In-Vehicle Digital Twin Service": FindByModel - response 
note left
FindByModel response:

endpoints: [
  {
    dtid: "sample-vehicle"
    model: "dtmi:sdv:Vehicle;1"
    protocol: "grpc"
    operations: [ "Get", "Set" ]
    uri: http://[::1]:40010
    context: "sample-vehicle"
  }
]
end note

"Massage Controller" -> "Digital Twin Provider - Vehicle": Get on endpoint for "sample-vehicle" - request

"Massage Controller" <- "Digital Twin Provider - Vehicle": Get - response
note left
Get response's payload (in JSON):

[
  {
    "$dtid": "sample-vehicle",
    "VehicleIdentification": {
      "VIN": "1M8GDM9AXKP042788"
    },
    "$metadata": {
      "model": "dtmi:sdv.Vehicle;1"
    }
  },
  { 
    "$relationshipId": "has-cabin-01", 
    "$sourceId": "sample-vehicle", 
    "$relationshipName": "HasCabin", 
    "$targetId": "sample-cabin", 
    "$metadata": {
      "sourceModel": "dtmi:sdv.Vehicle;1",
      "targetModel": "dtmi:sdv.Cabin;1"
    }
  },
  { 
    "$relationshipId": "has-obd-01", 
    "$sourceId": "sample-vehicle", 
    "$relationshipName": "HasOBD", 
    "$targetId": "sample-obd", 
    "$metadata": {
      "sourceModel": "dtmi:sdv.Vehcile;1",
      "targetModel": "dtmi:sdv.OBD;1"
    }
  }
]
end note

"Massage Controller" -> "In-Vehicle Digital Twin Service": FindByDigitalTwin("sample-cabin") - request

"Massage Controller" <- "In-Vehicle Digital Twin Service": FindByDigitalTwin - response 
note left
FindByDigitalTwin response:

endpoints: [
  {
    dtid: "sample-cabin"
    model: "dtmi:sdv:Cabin;1"
    protocol: "grpc"
    operations: [ "Get", "Set" ]
    uri: http://[::1]:50010
    context: "sample-cabin"
  }
]
end note


"Massage Controller" -> "Digital Twin Provider - Cabin": Get on endpoint for "sample-cabin" - request

"Massage Controller" <- "Digital Twin Provider - Cabin": Get - response
note left
Get response's payload (in JSON):

[
  {
    "$dtid": "sample-cabin",
    "$metadata": {
     "model": "dtmi:sdv.Cabin;1"
    }
  },
  { 
    "$relationshipId": "has-hvac-01", 
    "$sourceId": "sample-cabin", 
    "$relationshipName": "HasCabin", 
    "$targetId": "sample-hvac", 
    "$metadata": {
      "sourceModel": "dtmi:sdv.Cabin;1",
      "targetModel": "dtmi:sdv.HVAC;1"
    }
  },
  { 
    "$relationshipId": "has-infotainment-01", 
    "$sourceId": "sample-cabin", 
    "$relationshipName": "HasInfotainment", 
    "$targetId": "sample-infotainment", 
    "$metadata": {
      "sourceModel": "dtmi:sdv.Cabin;1",
      "targetModel": "dtmi:sdv.Infotainment;1"
    }
  },
  { 
    "$relationshipId": "has-seat-01", 
    "$sourceId": "sample-cabin", 
    "$relationshipName": "HasSeat", 
    "$targetId": "sample-front-left-seat", 
    "SeatRow": "front",
    "SeatPosition": "left",
    "$metadata": {
      "sourceModel": "dtmi:sdv.Cabin;1",
      "targetModel": "dtmi:sdv.FrontSeat;1"
    }
  },
  { 
    "$relationshipId": "has-seat-02", 
    "$sourceId": "sample-cabin", 
    "$relationshipName": "HasSeat", 
    "$targetId": "sample-front-right-seat", 
    "SeatRow": "front",
    "SeatPosition": "right",
    "$metadata": {
      "sourceModel": "dtmi:sdv.Cabin;1",
      "targetModel": "dtmi:sdv.FrontSeat;1"
    }
  }
} 
end note

"Massage Controller" -> "In-Vehicle Digital Twin Service": FindByDigitalTwin("sample-front-right-seat") - request

"Massage Controller" <- "In-Vehicle Digital Twin Service": FindByDigitalTwin - response 
note left
FindByDigitalTwin response:

endpoints: [
  {
    dtid: "sample-front-right-seat"
    model: "dtmi:sdv:FrontSeat;1"
    protocol: "grpc"
    operations: [ "Get", "Set" ]
    uri: http://[::1]:60010
    context: "sample-front-right-seat"
  }
]
end note

"Massage Controller" -> "Digital Twin Provider - FrontSeat": Get on endpoint for "sample-front-seat" - request

"Massage Controller" <- "Digital Twin Provider - FrontSeat": Get - response
note left
Get response's payload (in JSON):

[
  {
    "@dtid": "sample-front-seat",
    "@metadata": {
      "model": "dtmi:sdv.FrontSeat;1"
    }
  },
  { 
    "$relationshipId": "has-seatmassager-02", 
    "$sourceId": "sample-front-seat", 
    "$relationshipName": "HasSeat", 
    "$targetId": "sample-front-right-seat-massager", 
    "$metadata": {
      "sourceModel": "dtmi:sdv.FrontSeat;1",
      "targetModel": "dtmi:sdv.PremiumAirbagSeatMassager;1"
    }
  }
]
end note

"Massage Controller" -> "In-Vehicle Digital Twin Service": FindByDigitalTwin("sample-front-right-seat-massager") - request

"Massage Controller" <- "In-Vehicle Digital Twin Service": FindByDigitalTwin - response 
note left
FindByDigitalTwin response:

endpoints: [
  {
    dtid: "sample-front-right-seat-massager"
    model: "dtmi:sdv:PremiumAirbagSeatMassager;1"
    protocol: "grpc"
    operations: [ "Get", "Set" ]
    uri: http://[::1]:70010
    context: "sample-front-right-seat-massager"
  }
]
end note

loop until stopped
  "Massage Controller" -> "Digital Twin Provider - PremiumAirbagSeatMassager": Set on "sample-front-right-seat-massager" - request
  note right

  An example of one of the set calls:

  {
    "@dtid": "sample-front-right-seat-massager",
    "MassageAirBags": {
      25,
      25,
      50,
      50,
      75,
      75,
      100,
      100,
      75,
      75
    },
    "@metadata": {
      "model": "dtmi:sdv.PremiumAirbagSeatMassager;1"
    }
  }
  end note

  "Massage Controller" <- "Digital Twin Provider - PremiumAirbagSeatMassager": Set - response
end

@enduml
