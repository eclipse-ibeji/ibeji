<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1311px" preserveAspectRatio="none" style="width:1240px;height:1311px;background:#FFFFFF;" version="1.1" viewBox="0 0 1240 1311" width="1240px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="311" x="463.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="301" x="468.5" y="27.9951">Managed Subscribe Module Sequence</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="81" x2="81" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="263.5" x2="263.5" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="397.5" x2="397.5" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="809.5" x2="809.5" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="934.5" x2="934.5" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1204" x2="1204" y1="73.5938" y2="1276.1016"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="12" y="62.292">Digital Twin Provider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="12" y="1295.0967">Digital Twin Provider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="243.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="250.5" y="62.292">Ibeji</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="243.5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="250.5" y="1295.0967">Ibeji</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="206" x="294.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="301.5" y="62.292">Managed Subscribe Module</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="206" x="294.5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="301.5" y="1295.0967">Managed Subscribe Module</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="168" x="725.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="732.5" y="62.292">Digital Twin Consumer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="168" x="725.5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="732.5" y="1295.0967">Digital Twin Consumer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="903.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="910.5" y="62.292">Agemo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="903.5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="910.5" y="1295.0967">Agemo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="1174" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1181" y="62.292">Broker</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="1174" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1181" y="1295.0967">Broker</text><polygon fill="#181818" points="275,100.7266,265,104.7266,275,108.7266,271,104.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="269" x2="808.5" y1="104.7266" y2="104.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="281" y="99.6606">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="294" y="99.6606">FindById (entity_id)</text><polygon fill="#181818" points="797.5,129.8594,807.5,133.8594,797.5,137.8594,801.5,133.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="264" x2="803.5" y1="133.8594" y2="133.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="271" y="128.7935">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="284" y="128.7935">FindById - response</text><polygon fill="#181818" points="408.5,158.9922,398.5,162.9922,408.5,166.9922,404.5,162.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="402.5" x2="808.5" y1="162.9922" y2="162.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="414.5" y="157.9263">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="427.5" y="157.9263">GetSubscriptionInfo (entity_id, constraints {freq, acc, etc})</text><polygon fill="#181818" points="923,188.125,933,192.125,923,196.125,927,192.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="397.5" x2="929" y1="192.125" y2="192.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="404.5" y="187.0591">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="417.5" y="187.0591">CreateTopic - request</text><polygon fill="#181818" points="408.5,217.2578,398.5,221.2578,408.5,225.2578,404.5,221.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="402.5" x2="934" y1="221.2578" y2="221.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="414.5" y="216.1919">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="427.5" y="216.1919">CreateTopic - response</text><path d="M402,234.2578 L402,259.2578 L658,259.2578 L658,244.2578 L648,234.2578 L402,234.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M648,234.2578 L648,244.2578 L658,244.2578 L648,234.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="408" y="251.3247">SubInfo {topic, broker endpoint info}</text><line style="stroke:#181818;stroke-width:1.0;" x1="397.5" x2="439.5" y1="285.5234" y2="285.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="439.5" x2="439.5" y1="285.5234" y2="298.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="398.5" x2="439.5" y1="298.5234" y2="298.5234"/><polygon fill="#181818" points="408.5,294.5234,398.5,298.5234,408.5,302.5234,404.5,298.5234" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="404.5" y="280.4575">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="417.5" y="280.4575">Store entity_id and SubInfo metadata</text><polygon fill="#181818" points="797.5,323.6563,807.5,327.6563,797.5,331.6563,801.5,327.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="397.5" x2="803.5" y1="327.6563" y2="327.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="404.5" y="322.5903">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="417.5" y="322.5903">GetSubscriptionInfo - response</text><path d="M548,340.6563 L548,365.6563 L804,365.6563 L804,350.6563 L794,340.6563 L548,340.6563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M794,340.6563 L794,350.6563 L804,350.6563 L794,340.6563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="554" y="357.7231">SubInfo {topic, broker endpoint info}</text><polygon fill="#181818" points="1192,387.9219,1202,391.9219,1192,395.9219,1196,391.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="809.5" x2="1198" y1="391.9219" y2="391.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="816.5" y="386.856">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="829.5" y="386.856">Subscribe (SubInfo.topic)</text><polygon fill="#181818" points="946,417.0547,936,421.0547,946,425.0547,942,421.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="940" x2="1203" y1="421.0547" y2="421.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="952" y="415.9888">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="965" y="415.9888">Sub notification for SubInfo.topic</text><polygon fill="#181818" points="408.5,446.1875,398.5,450.1875,408.5,454.1875,404.5,450.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="402.5" x2="934" y1="450.1875" y2="450.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="414.5" y="445.1216">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="436.5" y="445.1216">ManageTopicCallback (SubInfo.topic, action)</text><polygon fill="#181818" points="92,475.3203,82,479.3203,92,483.3203,88,479.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="86" x2="396.5" y1="479.3203" y2="479.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="98" y="474.2544">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="120" y="474.2544">TopicManagementCB (action, payload)</text><path d="M86,492.3203 L86,713.3203 L322,713.3203 L322,502.3203 L312,492.3203 L86,492.3203 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M312,492.3203 L312,502.3203 L322,502.3203 L312,492.3203 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="92" y="509.3872">// Tells provider to start publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="92" y="524.52">// entity id data on provided topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="92" y="539.6528">// with the given constraints.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="92" y="554.7856"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="92" y="569.9185">action: PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="92" y="585.0513">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="108" y="600.1841">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="108" y="615.3169">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="108" y="630.4497">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="108" y="645.5825">subscription_info: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="124" y="660.7153">protocol, // MQTT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="124" y="675.8481">uri, // MQTT Broker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="108" y="690.981">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="92" y="706.1138">}</text><polygon fill="#181818" points="1192,736.3125,1202,740.3125,1192,744.3125,1196,740.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="81" x2="1198" y1="740.3125" y2="740.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="88" y="735.2466">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="110" y="735.2466">data</text><polygon fill="#181818" points="820.5,765.4453,810.5,769.4453,820.5,773.4453,816.5,769.4453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="814.5" x2="1203" y1="769.4453" y2="769.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="826.5" y="764.3794">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="848.5" y="764.3794">data</text><polygon fill="#181818" points="1192,794.5781,1202,798.5781,1192,802.5781,1196,798.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="809.5" x2="1198" y1="798.5781" y2="798.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="816.5" y="793.5122">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="838.5" y="793.5122">Unsubscribe (SubInfo.topic)</text><line style="stroke:#181818;stroke-width:2.0;" x1="816.5" x2="826.5" y1="822.7109" y2="832.7109"/><line style="stroke:#181818;stroke-width:2.0;" x1="816.5" x2="826.5" y1="832.7109" y2="822.7109"/><line style="stroke:#181818;stroke-width:1.0;" x1="821.5" x2="1203" y1="827.7109" y2="827.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="826.5" y="822.645">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="848.5" y="822.645">data</text><polygon fill="#181818" points="946,852.8438,936,856.8438,946,860.8438,942,856.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="940" x2="1203" y1="856.8438" y2="856.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="952" y="851.7778">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="974" y="851.7778">Unsub notification for SubInfo.topic</text><polygon fill="#181818" points="408.5,881.9766,398.5,885.9766,408.5,889.9766,404.5,885.9766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="402.5" x2="934" y1="885.9766" y2="885.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="414.5" y="880.9106">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="436.5" y="880.9106">ManageTopicCallback (SubInfo.topic, action)</text><polygon fill="#181818" points="92,911.1094,82,915.1094,92,919.1094,88,915.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="86" x2="396.5" y1="915.1094" y2="915.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="98" y="910.0435">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="120" y="910.0435">TopicManagementCB (action, payload)</text><path d="M86,928.1094 L86,1089.1094 L321,1089.1094 L321,938.1094 L311,928.1094 L86,928.1094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M311,928.1094 L311,938.1094 L321,938.1094 L311,928.1094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="92" y="945.1763">// Tells provider to stop publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="92" y="960.3091">// entity id data on provided topic.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="92" y="975.4419"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="92" y="990.5747">action: STOP_PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="92" y="1005.7075">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="108" y="1020.8403">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="108" y="1035.9731">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="108" y="1051.106">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="108" y="1066.2388">subscription_info: None,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="92" y="1081.3716">}</text><line style="stroke:#181818;stroke-width:2.0;" x1="1186" x2="1196" y1="1110.5703" y2="1120.5703"/><line style="stroke:#181818;stroke-width:2.0;" x1="1186" x2="1196" y1="1120.5703" y2="1110.5703"/><line style="stroke:#181818;stroke-width:1.0;" x1="81" x2="1191" y1="1115.5703" y2="1115.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="88" y="1110.5044">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="110" y="1110.5044">data</text><line style="stroke:#181818;stroke-width:1.0;" x1="81" x2="123" y1="1144.7031" y2="1144.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="123" y1="1144.7031" y2="1157.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="82" x2="123" y1="1157.7031" y2="1157.7031"/><polygon fill="#181818" points="92,1153.7031,82,1157.7031,92,1161.7031,88,1157.7031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="88" y="1139.6372">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="110" y="1139.6372">Remove topic mapping</text><polygon fill="#181818" points="923,1182.8359,933,1186.8359,923,1190.8359,927,1186.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="397.5" x2="929" y1="1186.8359" y2="1186.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="404.5" y="1181.77">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="426.5" y="1181.77">DeleteTopic (SubInfo.topic)</text><polygon fill="#181818" points="408.5,1211.9688,398.5,1215.9688,408.5,1219.9688,404.5,1215.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="402.5" x2="934" y1="1215.9688" y2="1215.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="414.5" y="1210.9028">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="436.5" y="1210.9028">DeleteTopic - response</text><line style="stroke:#181818;stroke-width:1.0;" x1="397.5" x2="439.5" y1="1245.1016" y2="1245.1016"/><line style="stroke:#181818;stroke-width:1.0;" x1="439.5" x2="439.5" y1="1245.1016" y2="1258.1016"/><line style="stroke:#181818;stroke-width:1.0;" x1="398.5" x2="439.5" y1="1258.1016" y2="1258.1016"/><polygon fill="#181818" points="408.5,1254.1016,398.5,1258.1016,408.5,1262.1016,404.5,1258.1016" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="404.5" y="1240.0356">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="426.5" y="1240.0356">Remove topic mapping</text><!--MD5=[7837af8edea847b9a08c9762e3763472]
@startuml Managed Subscribe Module
title Managed Subscribe Module Sequence
participant "Digital Twin Provider" as DTProvider
participant Ibeji
participant "Managed Subscribe Module" as ManagedSubscribeModule
participant "Digital Twin Consumer" as DTConsumer
participant Agemo
participant Broker

autonumber

DTConsumer -> Ibeji: FindById (entity_id)
DTConsumer <- Ibeji: FindById - response
DTConsumer -> ManagedSubscribeModule: GetSubscriptionInfo (entity_id, constraints {freq, acc, etc})
ManagedSubscribeModule -> Agemo: CreateTopic - request
Agemo -> ManagedSubscribeModule: CreateTopic - response
note right of ManagedSubscribeModule: SubInfo {topic, broker endpoint info}
ManagedSubscribeModule -> ManagedSubscribeModule: Store entity_id and SubInfo metadata
ManagedSubscribeModule -> DTConsumer: GetSubscriptionInfo - response
note left of DTConsumer: SubInfo {topic, broker endpoint info}
DTConsumer -> Broker: Subscribe (SubInfo.topic)
Broker -> Agemo: Sub notification for SubInfo.topic
Agemo -> ManagedSubscribeModule: ManageTopicCallback (SubInfo.topic, action)
ManagedSubscribeModule -> DTProvider: TopicManagementCB (action, payload)
note right of DTProvider
// Tells provider to start publishing
// entity id data on provided topic
// with the given constraints.

action: PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: {
        protocol, // MQTT
        uri, // MQTT Broker
    },
}
end note
DTProvider -> Broker: data
DTConsumer <- Broker : data
DTConsumer -> Broker: Unsubscribe (SubInfo.topic)
DTConsumer x<- Broker: data
Broker -> Agemo: Unsub notification for SubInfo.topic
Agemo -> ManagedSubscribeModule: ManageTopicCallback (SubInfo.topic, action)
DTProvider <- ManagedSubscribeModule: TopicManagementCB (action, payload)
note right of DTProvider
// Tells provider to stop publishing
// entity id data on provided topic.

action: STOP_PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: None,
}
end note
DTProvider ->x Broker: data
DTProvider -> DTProvider: Remove topic mapping
ManagedSubscribeModule -> Agemo: DeleteTopic (SubInfo.topic)
ManagedSubscribeModule <- Agemo: DeleteTopic - response
ManagedSubscribeModule -> ManagedSubscribeModule: Remove topic mapping
@enduml

PlantUML version 1.2022.7(Mon Aug 22 10:01:30 PDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>