<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1336px" preserveAspectRatio="none" style="width:1298px;height:1336px;background:#FFFFFF;" version="1.1" viewBox="0 0 1298 1336" width="1298px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="311" x="492.75" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="301" x="497.75" y="27.9951">Managed Subscribe Module Sequence</text><rect fill="#DDDDDD" height="1287.2344" style="stroke:#181818;stroke-width:0.5;" width="382" x="181" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="356.5" y="55.3638">Ibeji</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="81" x2="81" y1="93.7266" y2="1296.2344"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="264" x2="264" y1="93.7266" y2="1296.2344"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="456" x2="456" y1="93.7266" y2="1296.2344"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="868" x2="868" y1="93.7266" y2="1296.2344"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="993" x2="993" y1="93.7266" y2="1296.2344"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1262.5" x2="1262.5" y1="93.7266" y2="1296.2344"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="5" y="62.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="12" y="82.4248">Digital Twin Provider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="5" y="1295.2344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="12" y="1315.2295">Digital Twin Provider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="158" x="185" y="62.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="192" y="82.4248">InVehicle Digital Twin</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="158" x="185" y="1295.2344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="192" y="1315.2295">InVehicle Digital Twin</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="206" x="353" y="62.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="360" y="82.4248">Managed Subscribe Module</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="206" x="353" y="1295.2344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="192" x="360" y="1315.2295">Managed Subscribe Module</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="168" x="784" y="62.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="791" y="82.4248">Digital Twin Consumer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="168" x="784" y="1295.2344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="791" y="1315.2295">Digital Twin Consumer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="962" y="62.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="969" y="82.4248">Agemo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="962" y="1295.2344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="969" y="1315.2295">Agemo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="1232.5" y="62.4297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1239.5" y="82.4248">Broker</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="1232.5" y="1295.2344"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1239.5" y="1315.2295">Broker</text><polygon fill="#181818" points="275,120.8594,265,124.8594,275,128.8594,271,124.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="269" x2="867" y1="124.8594" y2="124.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="281" y="119.7935">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="294" y="119.7935">FindById (entity_id)</text><polygon fill="#181818" points="856,149.9922,866,153.9922,856,157.9922,860,153.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="264" x2="862" y1="153.9922" y2="153.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="271" y="148.9263">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="284" y="148.9263">FindById - response</text><polygon fill="#181818" points="467,179.125,457,183.125,467,187.125,463,183.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="461" x2="867" y1="183.125" y2="183.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="473" y="178.0591">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="486" y="178.0591">GetSubscriptionInfo (entity_id, constraints {freq, acc, etc})</text><polygon fill="#181818" points="981.5,208.2578,991.5,212.2578,981.5,216.2578,985.5,212.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="456" x2="987.5" y1="212.2578" y2="212.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="463" y="207.1919">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="476" y="207.1919">CreateTopic - request</text><polygon fill="#181818" points="467,237.3906,457,241.3906,467,245.3906,463,241.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="461" x2="992.5" y1="241.3906" y2="241.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="473" y="236.3247">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="486" y="236.3247">CreateTopic - response</text><path d="M461,254.3906 L461,279.3906 L717,279.3906 L717,264.3906 L707,254.3906 L461,254.3906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M707,254.3906 L707,264.3906 L717,264.3906 L707,254.3906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="467" y="271.4575">SubInfo {topic, broker endpoint info}</text><line style="stroke:#181818;stroke-width:1.0;" x1="456" x2="498" y1="305.6563" y2="305.6563"/><line style="stroke:#181818;stroke-width:1.0;" x1="498" x2="498" y1="305.6563" y2="318.6563"/><line style="stroke:#181818;stroke-width:1.0;" x1="457" x2="498" y1="318.6563" y2="318.6563"/><polygon fill="#181818" points="467,314.6563,457,318.6563,467,322.6563,463,318.6563" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="463" y="300.5903">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="476" y="300.5903">Store entity_id and SubInfo metadata</text><polygon fill="#181818" points="856,343.7891,866,347.7891,856,351.7891,860,347.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="456" x2="862" y1="347.7891" y2="347.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="463" y="342.7231">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="476" y="342.7231">GetSubscriptionInfo - response</text><path d="M607,360.7891 L607,385.7891 L863,385.7891 L863,370.7891 L853,360.7891 L607,360.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M853,360.7891 L853,370.7891 L863,370.7891 L853,360.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="613" y="377.856">SubInfo {topic, broker endpoint info}</text><polygon fill="#181818" points="1250.5,408.0547,1260.5,412.0547,1250.5,416.0547,1254.5,412.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="868" x2="1256.5" y1="412.0547" y2="412.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="875" y="406.9888">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="888" y="406.9888">Subscribe (SubInfo.topic)</text><polygon fill="#181818" points="1004.5,437.1875,994.5,441.1875,1004.5,445.1875,1000.5,441.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="998.5" x2="1261.5" y1="441.1875" y2="441.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1010.5" y="436.1216">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="1023.5" y="436.1216">Sub notification for SubInfo.topic</text><polygon fill="#181818" points="467,466.3203,457,470.3203,467,474.3203,463,470.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="461" x2="992.5" y1="470.3203" y2="470.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="473" y="465.2544">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="495" y="465.2544">ManageTopicCallback (SubInfo.topic, action)</text><polygon fill="#181818" points="92,495.4531,82,499.4531,92,503.4531,88,499.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="86" x2="455" y1="499.4531" y2="499.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="98" y="494.3872">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="120" y="494.3872">TopicManagementCB (action, payload)</text><path d="M86,512.4531 L86,733.4531 L322,733.4531 L322,522.4531 L312,512.4531 L86,512.4531 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M312,512.4531 L312,522.4531 L322,522.4531 L312,512.4531 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="92" y="529.52">// Tells provider to start publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="92" y="544.6528">// entity id data on provided topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="92" y="559.7856">// with the given constraints.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="92" y="574.9185"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="92" y="590.0513">action: PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="92" y="605.1841">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="108" y="620.3169">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="108" y="635.4497">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="108" y="650.5825">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="108" y="665.7153">subscription_info: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="124" y="680.8481">protocol, // MQTT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="124" y="695.981">uri, // MQTT Broker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="108" y="711.1138">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="92" y="726.2466">}</text><polygon fill="#181818" points="1250.5,756.4453,1260.5,760.4453,1250.5,764.4453,1254.5,760.4453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="81" x2="1256.5" y1="760.4453" y2="760.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="88" y="755.3794">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="110" y="755.3794">data</text><polygon fill="#181818" points="879,785.5781,869,789.5781,879,793.5781,875,789.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="873" x2="1261.5" y1="789.5781" y2="789.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="885" y="784.5122">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="907" y="784.5122">data</text><polygon fill="#181818" points="1250.5,814.7109,1260.5,818.7109,1250.5,822.7109,1254.5,818.7109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="868" x2="1256.5" y1="818.7109" y2="818.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="875" y="813.645">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="897" y="813.645">Unsubscribe (SubInfo.topic)</text><line style="stroke:#181818;stroke-width:2.0;" x1="875" x2="885" y1="842.8438" y2="852.8438"/><line style="stroke:#181818;stroke-width:2.0;" x1="875" x2="885" y1="852.8438" y2="842.8438"/><line style="stroke:#181818;stroke-width:1.0;" x1="880" x2="1261.5" y1="847.8438" y2="847.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="885" y="842.7778">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="907" y="842.7778">data</text><polygon fill="#181818" points="1004.5,872.9766,994.5,876.9766,1004.5,880.9766,1000.5,876.9766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="998.5" x2="1261.5" y1="876.9766" y2="876.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1010.5" y="871.9106">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="1032.5" y="871.9106">Unsub notification for SubInfo.topic</text><polygon fill="#181818" points="467,902.1094,457,906.1094,467,910.1094,463,906.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="461" x2="992.5" y1="906.1094" y2="906.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="473" y="901.0435">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="495" y="901.0435">ManageTopicCallback (SubInfo.topic, action)</text><polygon fill="#181818" points="92,931.2422,82,935.2422,92,939.2422,88,935.2422" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="86" x2="455" y1="935.2422" y2="935.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="98" y="930.1763">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="120" y="930.1763">TopicManagementCB (action, payload)</text><path d="M86,948.2422 L86,1109.2422 L321,1109.2422 L321,958.2422 L311,948.2422 L86,948.2422 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M311,948.2422 L311,958.2422 L321,958.2422 L311,948.2422 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="92" y="965.3091">// Tells provider to stop publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="92" y="980.4419">// entity id data on provided topic.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="92" y="995.5747"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="92" y="1010.7075">action: STOP_PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="92" y="1025.8403">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="108" y="1040.9731">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="108" y="1056.106">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="108" y="1071.2388">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="108" y="1086.3716">subscription_info: None,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="92" y="1101.5044">}</text><line style="stroke:#181818;stroke-width:2.0;" x1="1244.5" x2="1254.5" y1="1130.7031" y2="1140.7031"/><line style="stroke:#181818;stroke-width:2.0;" x1="1244.5" x2="1254.5" y1="1140.7031" y2="1130.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="81" x2="1249.5" y1="1135.7031" y2="1135.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="88" y="1130.6372">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="110" y="1130.6372">data</text><line style="stroke:#181818;stroke-width:1.0;" x1="81" x2="123" y1="1164.8359" y2="1164.8359"/><line style="stroke:#181818;stroke-width:1.0;" x1="123" x2="123" y1="1164.8359" y2="1177.8359"/><line style="stroke:#181818;stroke-width:1.0;" x1="82" x2="123" y1="1177.8359" y2="1177.8359"/><polygon fill="#181818" points="92,1173.8359,82,1177.8359,92,1181.8359,88,1177.8359" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="88" y="1159.77">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="110" y="1159.77">Remove topic mapping</text><polygon fill="#181818" points="981.5,1202.9688,991.5,1206.9688,981.5,1210.9688,985.5,1206.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="456" x2="987.5" y1="1206.9688" y2="1206.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="463" y="1201.9028">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="485" y="1201.9028">DeleteTopic (SubInfo.topic)</text><polygon fill="#181818" points="467,1232.1016,457,1236.1016,467,1240.1016,463,1236.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="461" x2="992.5" y1="1236.1016" y2="1236.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="473" y="1231.0356">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="495" y="1231.0356">DeleteTopic - response</text><line style="stroke:#181818;stroke-width:1.0;" x1="456" x2="498" y1="1265.2344" y2="1265.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="498" x2="498" y1="1265.2344" y2="1278.2344"/><line style="stroke:#181818;stroke-width:1.0;" x1="457" x2="498" y1="1278.2344" y2="1278.2344"/><polygon fill="#181818" points="467,1274.2344,457,1278.2344,467,1282.2344,463,1278.2344" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="463" y="1260.1685">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="485" y="1260.1685">Remove topic mapping</text><!--MD5=[729eddabd9510d13ccc2f7e0ccd71346]
@startuml Managed Subscribe Module
title Managed Subscribe Module Sequence
participant "Digital Twin Provider" as DTProvider
box "Ibeji"
participant "InVehicle Digital Twin" as Ibeji
participant "Managed Subscribe Module" as ManagedSubscribeModule
end box
participant "Digital Twin Consumer" as DTConsumer
participant Agemo
participant Broker

autonumber

DTConsumer -> Ibeji: FindById (entity_id)
DTConsumer <- Ibeji: FindById - response
DTConsumer -> ManagedSubscribeModule: GetSubscriptionInfo (entity_id, constraints {freq, acc, etc})
ManagedSubscribeModule -> Agemo: CreateTopic - request
Agemo -> ManagedSubscribeModule: CreateTopic - response
note right of ManagedSubscribeModule: SubInfo {topic, broker endpoint info}
ManagedSubscribeModule -> ManagedSubscribeModule: Store entity_id and SubInfo metadata
ManagedSubscribeModule -> DTConsumer: GetSubscriptionInfo - response
note left of DTConsumer: SubInfo {topic, broker endpoint info}
DTConsumer -> Broker: Subscribe (SubInfo.topic)
Broker -> Agemo: Sub notification for SubInfo.topic
Agemo -> ManagedSubscribeModule: ManageTopicCallback (SubInfo.topic, action)
ManagedSubscribeModule -> DTProvider: TopicManagementCB (action, payload)
note right of DTProvider
// Tells provider to start publishing
// entity id data on provided topic
// with the given constraints.

action: PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: {
        protocol, // MQTT
        uri, // MQTT Broker
    },
}
end note
DTProvider -> Broker: data
DTConsumer <- Broker : data
DTConsumer -> Broker: Unsubscribe (SubInfo.topic)
DTConsumer x<- Broker: data
Broker -> Agemo: Unsub notification for SubInfo.topic
Agemo -> ManagedSubscribeModule: ManageTopicCallback (SubInfo.topic, action)
DTProvider <- ManagedSubscribeModule: TopicManagementCB (action, payload)
note right of DTProvider
// Tells provider to stop publishing
// entity id data on provided topic.

action: STOP_PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: None,
}
end note
DTProvider ->x Broker: data
DTProvider -> DTProvider: Remove topic mapping
ManagedSubscribeModule -> Agemo: DeleteTopic (SubInfo.topic)
ManagedSubscribeModule <- Agemo: DeleteTopic - response
ManagedSubscribeModule -> ManagedSubscribeModule: Remove topic mapping
@enduml

PlantUML version 1.2022.7(Mon Aug 22 10:01:30 PDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>