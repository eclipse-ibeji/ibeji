<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1311px" preserveAspectRatio="none" style="width:1174px;height:1311px;background:#FFFFFF;" version="1.1" viewBox="0 0 1174 1311" width="1174px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="311" x="430.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="301" x="435.5" y="27.9951">Managed Subscribe Module Sequence</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="50" x2="50" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="232.5" x2="232.5" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="362.5" x2="362.5" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="774.5" x2="774.5" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="868.5" x2="868.5" y1="73.5938" y2="1276.1016"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1138" x2="1138" y1="73.5938" y2="1276.1016"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="12" y="62.292">DTProvider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="12" y="1295.0967">DTProvider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="212.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="219.5" y="62.292">Ibeji</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="212.5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="219.5" y="1295.0967">Ibeji</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="198" x="263.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="270.5" y="62.292">ManagedSubscribeModule</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="198" x="263.5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="270.5" y="1295.0967">ManagedSubscribeModule</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="721.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="728.5" y="62.292">DTConsumer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="721.5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="728.5" y="1295.0967">DTConsumer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="837.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="844.5" y="62.292">Agemo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="837.5" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="844.5" y="1295.0967">Agemo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="1108" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1115" y="62.292">Broker</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="1108" y="1275.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1115" y="1295.0967">Broker</text><polygon fill="#181818" points="244,100.7266,234,104.7266,244,108.7266,240,104.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="238" x2="773.5" y1="104.7266" y2="104.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="250" y="99.6606">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="263" y="99.6606">FindById (Temp)</text><polygon fill="#181818" points="762.5,129.8594,772.5,133.8594,762.5,137.8594,766.5,133.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="233" x2="768.5" y1="133.8594" y2="133.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="240" y="128.7935">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="253" y="128.7935">FindById - response</text><polygon fill="#181818" points="373.5,158.9922,363.5,162.9922,373.5,166.9922,369.5,162.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367.5" x2="773.5" y1="162.9922" y2="162.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="379.5" y="157.9263">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="392.5" y="157.9263">GetSubscriptionInfo (entity_id, constraints {freq, acc, etc})</text><polygon fill="#181818" points="857,188.125,867,192.125,857,196.125,861,192.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="362.5" x2="863" y1="192.125" y2="192.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="369.5" y="187.0591">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="382.5" y="187.0591">CreateTopic - request</text><polygon fill="#181818" points="373.5,217.2578,363.5,221.2578,373.5,225.2578,369.5,221.2578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367.5" x2="868" y1="221.2578" y2="221.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="379.5" y="216.1919">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="392.5" y="216.1919">CreateTopic - response</text><path d="M367,234.2578 L367,259.2578 L623,259.2578 L623,244.2578 L613,234.2578 L367,234.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M613,234.2578 L613,244.2578 L623,244.2578 L613,234.2578 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="373" y="251.3247">SubInfo {topic, broker endpoint info}</text><line style="stroke:#181818;stroke-width:1.0;" x1="362.5" x2="404.5" y1="285.5234" y2="285.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="404.5" x2="404.5" y1="285.5234" y2="298.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="363.5" x2="404.5" y1="298.5234" y2="298.5234"/><polygon fill="#181818" points="373.5,294.5234,363.5,298.5234,373.5,302.5234,369.5,298.5234" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="369.5" y="280.4575">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="382.5" y="280.4575">Store entity_id and SubInfo metadata</text><polygon fill="#181818" points="762.5,323.6563,772.5,327.6563,762.5,331.6563,766.5,327.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="362.5" x2="768.5" y1="327.6563" y2="327.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="369.5" y="322.5903">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="382.5" y="322.5903">GetSubscriptionInfo - response</text><path d="M513,340.6563 L513,365.6563 L769,365.6563 L769,350.6563 L759,340.6563 L513,340.6563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M759,340.6563 L759,350.6563 L769,350.6563 L759,340.6563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="519" y="357.7231">SubInfo {topic, broker endpoint info}</text><polygon fill="#181818" points="1126,387.9219,1136,391.9219,1126,395.9219,1130,391.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="774.5" x2="1132" y1="391.9219" y2="391.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="781.5" y="386.856">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="794.5" y="386.856">Subscribe (SubInfo.topic)</text><polygon fill="#181818" points="880,417.0547,870,421.0547,880,425.0547,876,421.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="874" x2="1137" y1="421.0547" y2="421.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="886" y="415.9888">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="899" y="415.9888">Sub notification for SubInfo.topic</text><polygon fill="#181818" points="373.5,446.1875,363.5,450.1875,373.5,454.1875,369.5,450.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367.5" x2="868" y1="450.1875" y2="450.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="379.5" y="445.1216">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="401.5" y="445.1216">ManageTopicCallback (SubInfo.topic, action)</text><polygon fill="#181818" points="61,475.3203,51,479.3203,61,483.3203,57,479.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="55" x2="361.5" y1="479.3203" y2="479.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="67" y="474.2544">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="89" y="474.2544">TopicManagementCB (action, payload)</text><path d="M55,492.3203 L55,713.3203 L291,713.3203 L291,502.3203 L281,492.3203 L55,492.3203 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M281,492.3203 L281,502.3203 L291,502.3203 L281,492.3203 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="61" y="509.3872">// Tells provider to start publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="61" y="524.52">// entity id data on provided topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="61" y="539.6528">// with the given constraints.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="61" y="554.7856"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="61" y="569.9185">action: PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="61" y="585.0513">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="77" y="600.1841">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="77" y="615.3169">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="77" y="630.4497">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="77" y="645.5825">subscription_info: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="93" y="660.7153">protocol, // MQTT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="93" y="675.8481">uri, // MQTT Broker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="77" y="690.981">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="61" y="706.1138">}</text><polygon fill="#181818" points="1126,736.3125,1136,740.3125,1126,744.3125,1130,740.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="50" x2="1132" y1="740.3125" y2="740.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="57" y="735.2466">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="79" y="735.2466">data</text><polygon fill="#181818" points="785.5,765.4453,775.5,769.4453,785.5,773.4453,781.5,769.4453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="779.5" x2="1137" y1="769.4453" y2="769.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="791.5" y="764.3794">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="813.5" y="764.3794">data</text><polygon fill="#181818" points="1126,794.5781,1136,798.5781,1126,802.5781,1130,798.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="774.5" x2="1132" y1="798.5781" y2="798.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="781.5" y="793.5122">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="803.5" y="793.5122">Unsubscribe (SubInfo.topic)</text><line style="stroke:#181818;stroke-width:2.0;" x1="781.5" x2="791.5" y1="822.7109" y2="832.7109"/><line style="stroke:#181818;stroke-width:2.0;" x1="781.5" x2="791.5" y1="832.7109" y2="822.7109"/><line style="stroke:#181818;stroke-width:1.0;" x1="786.5" x2="1137" y1="827.7109" y2="827.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="791.5" y="822.645">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="813.5" y="822.645">data</text><polygon fill="#181818" points="880,852.8438,870,856.8438,880,860.8438,876,856.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="874" x2="1137" y1="856.8438" y2="856.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="886" y="851.7778">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="908" y="851.7778">Unsub notification for SubInfo.topic</text><polygon fill="#181818" points="373.5,881.9766,363.5,885.9766,373.5,889.9766,369.5,885.9766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367.5" x2="868" y1="885.9766" y2="885.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="379.5" y="880.9106">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="401.5" y="880.9106">ManageTopicCallback (SubInfo.topic, action)</text><polygon fill="#181818" points="61,911.1094,51,915.1094,61,919.1094,57,915.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="55" x2="361.5" y1="915.1094" y2="915.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="67" y="910.0435">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="89" y="910.0435">TopicManagementCB (action, payload)</text><path d="M55,928.1094 L55,1089.1094 L290,1089.1094 L290,938.1094 L280,928.1094 L55,928.1094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M280,928.1094 L280,938.1094 L290,938.1094 L280,928.1094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="61" y="945.1763">// Tells provider to stop publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="61" y="960.3091">// entity id data on provided topic.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="61" y="975.4419"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="61" y="990.5747">action: STOP_PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="61" y="1005.7075">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="77" y="1020.8403">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="77" y="1035.9731">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="77" y="1051.106">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="77" y="1066.2388">subscription_info: None,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="61" y="1081.3716">}</text><line style="stroke:#181818;stroke-width:2.0;" x1="1120" x2="1130" y1="1110.5703" y2="1120.5703"/><line style="stroke:#181818;stroke-width:2.0;" x1="1120" x2="1130" y1="1120.5703" y2="1110.5703"/><line style="stroke:#181818;stroke-width:1.0;" x1="50" x2="1125" y1="1115.5703" y2="1115.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="57" y="1110.5044">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="79" y="1110.5044">data</text><line style="stroke:#181818;stroke-width:1.0;" x1="50" x2="92" y1="1144.7031" y2="1144.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="92" x2="92" y1="1144.7031" y2="1157.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="51" x2="92" y1="1157.7031" y2="1157.7031"/><polygon fill="#181818" points="61,1153.7031,51,1157.7031,61,1161.7031,57,1157.7031" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="57" y="1139.6372">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="79" y="1139.6372">Remove topic mapping</text><polygon fill="#181818" points="857,1182.8359,867,1186.8359,857,1190.8359,861,1186.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="362.5" x2="863" y1="1186.8359" y2="1186.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="369.5" y="1181.77">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="391.5" y="1181.77">DeleteTopic (SubInfo.topic)</text><polygon fill="#181818" points="373.5,1211.9688,363.5,1215.9688,373.5,1219.9688,369.5,1215.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367.5" x2="868" y1="1215.9688" y2="1215.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="379.5" y="1210.9028">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="401.5" y="1210.9028">DeleteTopic - response</text><line style="stroke:#181818;stroke-width:1.0;" x1="362.5" x2="404.5" y1="1245.1016" y2="1245.1016"/><line style="stroke:#181818;stroke-width:1.0;" x1="404.5" x2="404.5" y1="1245.1016" y2="1258.1016"/><line style="stroke:#181818;stroke-width:1.0;" x1="363.5" x2="404.5" y1="1258.1016" y2="1258.1016"/><polygon fill="#181818" points="373.5,1254.1016,363.5,1258.1016,373.5,1262.1016,369.5,1258.1016" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="369.5" y="1240.0356">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="391.5" y="1240.0356">Remove topic mapping</text><!--MD5=[8fb20ee965d28eba369de55ec57150df]
@startuml Managed Subscribe Module
title Managed Subscribe Module Sequence
participant DTProvider
participant Ibeji
participant ManagedSubscribeModule
participant DTConsumer
participant Agemo
participant Broker

autonumber

DTConsumer -> Ibeji: FindById (Temp)
DTConsumer <- Ibeji: FindById - response
DTConsumer -> ManagedSubscribeModule: GetSubscriptionInfo (entity_id, constraints {freq, acc, etc})
ManagedSubscribeModule -> Agemo: CreateTopic - request
Agemo -> ManagedSubscribeModule: CreateTopic - response
note right of ManagedSubscribeModule: SubInfo {topic, broker endpoint info}
ManagedSubscribeModule -> ManagedSubscribeModule: Store entity_id and SubInfo metadata
ManagedSubscribeModule -> DTConsumer: GetSubscriptionInfo - response
note left of DTConsumer: SubInfo {topic, broker endpoint info}
DTConsumer -> Broker: Subscribe (SubInfo.topic)
Broker -> Agemo: Sub notification for SubInfo.topic
Agemo -> ManagedSubscribeModule: ManageTopicCallback (SubInfo.topic, action)
ManagedSubscribeModule -> DTProvider: TopicManagementCB (action, payload)
note right of DTProvider
// Tells provider to start publishing
// entity id data on provided topic
// with the given constraints.

action: PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: {
        protocol, // MQTT
        uri, // MQTT Broker
    },
}
end note
DTProvider -> Broker: data
DTConsumer <- Broker : data
DTConsumer -> Broker: Unsubscribe (SubInfo.topic)
DTConsumer x<- Broker: data
Broker -> Agemo: Unsub notification for SubInfo.topic
Agemo -> ManagedSubscribeModule: ManageTopicCallback (SubInfo.topic, action)
DTProvider <- ManagedSubscribeModule: TopicManagementCB (action, payload) 
note right of DTProvider
// Tells provider to stop publishing
// entity id data on provided topic.

action: STOP_PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: None,
}
end note
DTProvider ->x Broker: data
DTProvider -> DTProvider: Remove topic mapping
ManagedSubscribeModule -> Agemo: DeleteTopic (SubInfo.topic)
ManagedSubscribeModule <- Agemo: DeleteTopic - response
ManagedSubscribeModule -> ManagedSubscribeModule: Remove topic mapping
@enduml

PlantUML version 1.2022.7(Mon Aug 22 10:01:30 PDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>