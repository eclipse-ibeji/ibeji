<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="932px" preserveAspectRatio="none" style="width:489px;height:932px;background:#FEFEFE;" version="1.1" viewBox="0 0 489 932" width="489px" zoomAndPan="magnify"><defs><filter height="300%" id="f5unvuc8319d9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="465" x="12" y="22.9951">Managed Subscribe Sequence from Provider's Perspective</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="93.25" x2="93.25" y1="68.5938" y2="892.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="376.75" x2="376.75" y1="68.5938" y2="892.0391"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="441.75" x2="441.75" y1="68.5938" y2="892.0391"/><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="15.25" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="22.25" y="53.292">Digital Twin Provider</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="15.25" y="891.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="22.25" y="911.0342">Digital Twin Provider</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="354.75" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="361.75" y="53.292">Ibeji</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="354.75" y="891.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="361.75" y="911.0342">Ibeji</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="409.75" y="33.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="416.75" y="53.292">Broker</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="409.75" y="891.0391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="416.75" y="911.0342">Broker</text><polygon fill="#A80036" points="365.25,95.7266,375.25,99.7266,365.25,103.7266,369.25,99.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93.25" x2="371.25" y1="99.7266" y2="99.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="100.25" y="94.6606">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="113.25" y="94.6606">Register - request</text><path d="M98.25,112.7266 L98.25,273.7266 L353.25,273.7266 L353.25,122.7266 L343.25,112.7266 L98.25,112.7266 " fill="#FBFB77" filter="url(#f5unvuc8319d9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M343.25,112.7266 L343.25,122.7266 L353.25,122.7266 L343.25,112.7266 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="104.25" y="129.7935">Entry that indicates to Ibeji that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="104.25" y="144.9263">the Provider wants to utilize the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="104.25" y="160.0591">Managed Subscribe Module.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="108.25" y="175.1919"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="104.25" y="190.3247">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="120.25" y="205.4575">protocol: "grpc"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="120.25" y="220.5903">operations: ["ManagedSubscribe"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="120.25" y="235.7231">uri: "Provider callback uri"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="120.25" y="250.856">context: ""</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="104.25" y="265.9888">}</text><polygon fill="#A80036" points="104.25,300.1875,94.25,304.1875,104.25,308.1875,100.25,304.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98.25" x2="376.25" y1="304.1875" y2="304.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="110.25" y="299.1216">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="123.25" y="299.1216">Register - response</text><polygon fill="#A80036" points="104.25,329.3203,94.25,333.3203,104.25,337.3203,100.25,333.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98.25" x2="376.25" y1="333.3203" y2="333.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="110.25" y="328.2544">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="123.25" y="328.2544">TopicManagementCB (action, payload)</text><path d="M98.25,346.3203 L98.25,567.3203 L322.25,567.3203 L322.25,356.3203 L312.25,346.3203 L98.25,346.3203 " fill="#FBFB77" filter="url(#f5unvuc8319d9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M312.25,346.3203 L312.25,356.3203 L322.25,356.3203 L312.25,346.3203 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="104.25" y="363.3872">Tells provider to start publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="104.25" y="378.52">entity id data on provided topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="104.25" y="393.6528">with the given constraints.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="108.25" y="408.7856"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="104.25" y="423.9185">action: PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="104.25" y="439.0513">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="120.25" y="454.1841">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="120.25" y="469.3169">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="120.25" y="484.4497">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="120.25" y="499.5825">subscription_info: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="136.25" y="514.7153">protocol, // MQTT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="136.25" y="529.8481">uri, // MQTT Broker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="120.25" y="544.981">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="104.25" y="560.1138">}</text><polygon fill="#A80036" points="429.75,594.3125,439.75,598.3125,429.75,602.3125,433.75,598.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93.25" x2="435.75" y1="598.3125" y2="598.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="100.25" y="593.2466">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="113.25" y="593.2466">data</text><polygon fill="#A80036" points="104.25,623.4453,94.25,627.4453,104.25,631.4453,100.25,627.4453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98.25" x2="376.25" y1="627.4453" y2="627.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="110.25" y="622.3794">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="123.25" y="622.3794">TopicManagementCB (action, payload)</text><path d="M98.25,640.4453 L98.25,801.4453 L321.25,801.4453 L321.25,650.4453 L311.25,640.4453 L98.25,640.4453 " fill="#FBFB77" filter="url(#f5unvuc8319d9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M311.25,640.4453 L311.25,650.4453 L321.25,650.4453 L311.25,640.4453 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="104.25" y="657.5122">Tells provider to stop publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="104.25" y="672.645">entity id data on provided topic.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="108.25" y="687.7778"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="104.25" y="702.9106">action: STOP_PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="104.25" y="718.0435">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="120.25" y="733.1763">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="120.25" y="748.3091">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="120.25" y="763.4419">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="120.25" y="778.5747">subscription_info: None,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="104.25" y="793.7075">}</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="423.75" x2="433.75" y1="826.9063" y2="836.9063"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="423.75" x2="433.75" y1="836.9063" y2="826.9063"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93.25" x2="428.75" y1="831.9063" y2="831.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="100.25" y="826.8403">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="113.25" y="826.8403">data</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="93.25" x2="135.25" y1="861.0391" y2="861.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="135.25" x2="135.25" y1="861.0391" y2="874.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94.25" x2="135.25" y1="874.0391" y2="874.0391"/><polygon fill="#A80036" points="104.25,870.0391,94.25,874.0391,104.25,878.0391,100.25,874.0391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="100.25" y="855.9731">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="113.25" y="855.9731">Remove topic mapping</text><!--
@startuml
skinparamlocked backgroundColor fefefe
title Managed Subscribe Sequence from Provider's Perspective
participant "Digital Twin Provider" as DTProvider
participant Ibeji
participant Broker

autonumber

DTProvider -> Ibeji: Register - request
note right of DTProvider
Entry that indicates to Ibeji that
the Provider wants to utilize the
Managed Subscribe Module.

{
    protocol: "grpc"
    operations: ["ManagedSubscribe"]
    uri: "Provider callback uri"
    context: ""
}
end note
Ibeji -> DTProvider: Register - response

Ibeji -> DTProvider: TopicManagementCB (action, payload)
note right of DTProvider
Tells provider to start publishing
entity id data on provided topic
with the given constraints.

action: PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: {
        protocol, // MQTT
        uri, // MQTT Broker
    },
}
end note
DTProvider -> Broker: data
DTProvider <- Ibeji: TopicManagementCB (action, payload)
note right of DTProvider
Tells provider to stop publishing
entity id data on provided topic.

action: STOP_PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: None,
}
end note
DTProvider ->x Broker: data
DTProvider -> DTProvider: Remove topic mapping
@enduml

PlantUML version 1.2018.13(Mon Nov 26 09:11:51 PST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.21+9-post-Ubuntu-0ubuntu120.04
Operating System: Linux
OS Version: 5.4.0-171-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>