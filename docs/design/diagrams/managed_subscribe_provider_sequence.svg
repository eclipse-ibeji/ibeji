<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="936px" preserveAspectRatio="none" style="width:538px;height:936px;background:#FEFEFE;" version="1.1" viewBox="0 0 538 936" width="538px" zoomAndPan="magnify"><defs><filter height="300%" id="f5unvuc8319d9" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="514" x="12" y="26.708">Managed Subscribe Sequence from Provider's Perspective</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="117.75" x2="117.75" y1="73.25" y2="896.6953"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="401.25" x2="401.25" y1="73.25" y2="896.6953"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="466.25" x2="466.25" y1="73.25" y2="896.6953"/><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="39.75" y="37.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="46.75" y="57.9482">Digital Twin Provider</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="39.75" y="895.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="46.75" y="915.6904">Digital Twin Provider</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="379.25" y="37.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="386.25" y="57.9482">Ibeji</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="379.25" y="895.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="386.25" y="915.6904">Ibeji</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="434.25" y="37.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="441.25" y="57.9482">Broker</text><rect fill="#FEFECE" filter="url(#f5unvuc8319d9)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="60" x="434.25" y="895.6953"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="441.25" y="915.6904">Broker</text><polygon fill="#A80036" points="389.75,100.3828,399.75,104.3828,389.75,108.3828,393.75,104.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.75" x2="395.75" y1="104.3828" y2="104.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.75" y="99.3169">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="137.75" y="99.3169">Register - request</text><path d="M122.75,117.3828 L122.75,278.3828 L377.75,278.3828 L377.75,127.3828 L367.75,117.3828 L122.75,117.3828 " fill="#FBFB77" filter="url(#f5unvuc8319d9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M367.75,117.3828 L367.75,127.3828 L377.75,127.3828 L367.75,117.3828 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="128.75" y="134.4497">Entry that indicates to Ibeji that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="128.75" y="149.5825">the Provider wants to utilize the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="128.75" y="164.7153">Managed Subscribe Module.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="132.75" y="179.8481"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="128.75" y="194.981">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="144.75" y="210.1138">protocol: "grpc"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="144.75" y="225.2466">operations: ["ManagedSubscribe"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="144.75" y="240.3794">uri: "Provider callback uri"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="144.75" y="255.5122">context: ""</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="128.75" y="270.645">}</text><polygon fill="#A80036" points="128.75,304.8438,118.75,308.8438,128.75,312.8438,124.75,308.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122.75" x2="400.75" y1="308.8438" y2="308.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="134.75" y="303.7778">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="147.75" y="303.7778">Register - response</text><polygon fill="#A80036" points="128.75,333.9766,118.75,337.9766,128.75,341.9766,124.75,337.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122.75" x2="400.75" y1="337.9766" y2="337.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="134.75" y="332.9106">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="147.75" y="332.9106">TopicManagementCB (action, payload)</text><path d="M122.75,350.9766 L122.75,571.9766 L346.75,571.9766 L346.75,360.9766 L336.75,350.9766 L122.75,350.9766 " fill="#FBFB77" filter="url(#f5unvuc8319d9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M336.75,350.9766 L336.75,360.9766 L346.75,360.9766 L336.75,350.9766 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="128.75" y="368.0435">Tells provider to start publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="128.75" y="383.1763">entity id data on provided topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="128.75" y="398.3091">with the given constraints.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="132.75" y="413.4419"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="128.75" y="428.5747">action: PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128.75" y="443.7075">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="144.75" y="458.8403">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="144.75" y="473.9731">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="144.75" y="489.106">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="144.75" y="504.2388">subscription_info: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="160.75" y="519.3716">protocol, // MQTT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="160.75" y="534.5044">uri, // MQTT Broker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="144.75" y="549.6372">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="128.75" y="564.77">}</text><polygon fill="#A80036" points="454.25,598.9688,464.25,602.9688,454.25,606.9688,458.25,602.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.75" x2="460.25" y1="602.9688" y2="602.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.75" y="597.9028">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="137.75" y="597.9028">data</text><polygon fill="#A80036" points="128.75,628.1016,118.75,632.1016,128.75,636.1016,124.75,632.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="122.75" x2="400.75" y1="632.1016" y2="632.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="134.75" y="627.0356">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="147.75" y="627.0356">TopicManagementCB (action, payload)</text><path d="M122.75,645.1016 L122.75,806.1016 L345.75,806.1016 L345.75,655.1016 L335.75,645.1016 L122.75,645.1016 " fill="#FBFB77" filter="url(#f5unvuc8319d9)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M335.75,645.1016 L335.75,655.1016 L345.75,655.1016 L335.75,645.1016 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="128.75" y="662.1685">Tells provider to stop publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="128.75" y="677.3013">entity id data on provided topic.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="132.75" y="692.4341"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="128.75" y="707.5669">action: STOP_PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="128.75" y="722.6997">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="144.75" y="737.8325">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="144.75" y="752.9653">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="144.75" y="768.0981">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="144.75" y="783.231">subscription_info: None,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="128.75" y="798.3638">}</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="448.25" x2="458.25" y1="831.5625" y2="841.5625"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="448.25" x2="458.25" y1="841.5625" y2="831.5625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.75" x2="453.25" y1="836.5625" y2="836.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.75" y="831.4966">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="137.75" y="831.4966">data</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.75" x2="159.75" y1="865.6953" y2="865.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="159.75" x2="159.75" y1="865.6953" y2="878.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="118.75" x2="159.75" y1="878.6953" y2="878.6953"/><polygon fill="#A80036" points="128.75,874.6953,118.75,878.6953,128.75,882.6953,124.75,878.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="124.75" y="860.6294">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="137.75" y="860.6294">Remove topic mapping</text><!--MD5=[c468ac1c93fe1f3e5208761b5c454226]
@startuml
skinparamlocked backgroundColor fefefe
title Managed Subscribe Sequence from Provider's Perspective
participant "Digital Twin Provider" as DTProvider
participant Ibeji
participant Broker

autonumber

DTProvider -> Ibeji: Register - request
note right of DTProvider
Entry that indicates to Ibeji that
the Provider wants to utilize the
Managed Subscribe Module.

{
    protocol: "grpc"
    operations: ["ManagedSubscribe"]
    uri: "Provider callback uri"
    context: ""
}
end note
Ibeji -> DTProvider: Register - response

Ibeji -> DTProvider: TopicManagementCB (action, payload)
note right of DTProvider
Tells provider to start publishing
entity id data on provided topic
with the given constraints.

action: PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: {
        protocol, // MQTT
        uri, // MQTT Broker
    },
}
end note
DTProvider -> Broker: data
DTProvider <- Ibeji: TopicManagementCB (action, payload)
note right of DTProvider
Tells provider to stop publishing
entity id data on provided topic.

action: STOP_PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: None,
}
end note
DTProvider ->x Broker: data
DTProvider -> DTProvider: Remove topic mapping
@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.22+7
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>