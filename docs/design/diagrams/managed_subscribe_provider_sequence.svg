<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="890px" preserveAspectRatio="none" style="width:493px;height:890px;background:#FFFFFF;" version="1.1" viewBox="0 0 493 890" width="493px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="475" x="5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="465" x="10" y="27.9951">Managed Subscribe Sequence from Provider's Perspective</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="93.75" x2="93.75" y1="73.5938" y2="854.7734"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="377.25" x2="377.25" y1="73.5938" y2="854.7734"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="438.25" x2="438.25" y1="73.5938" y2="854.7734"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="17.75" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="24.75" y="62.292">Digital Twin Provider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="152" x="17.75" y="853.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="24.75" y="873.7686">Digital Twin Provider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="357.25" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="364.25" y="62.292">Ibeji</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="357.25" y="853.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="364.25" y="873.7686">Ibeji</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="408.25" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="415.25" y="62.292">Broker</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="408.25" y="853.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="415.25" y="873.7686">Broker</text><polygon fill="#181818" points="365.75,100.7266,375.75,104.7266,365.75,108.7266,369.75,104.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="93.75" x2="371.75" y1="104.7266" y2="104.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="100.75" y="99.6606">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="113.75" y="99.6606">Register - request</text><path d="M98.75,117.7266 L98.75,248.7266 L435.75,248.7266 L435.75,127.7266 L425.75,117.7266 L98.75,117.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M425.75,117.7266 L425.75,127.7266 L435.75,127.7266 L425.75,117.7266 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="293" x="104.75" y="134.7935">// Entry that indicates to Ibeji that the Provider</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="104.75" y="149.9263">// wants to utilize the Managed Subscribe Module.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="104.75" y="165.0591">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="120.75" y="180.1919">protocol: "grpc"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="120.75" y="195.3247">operations: ["ManagedSubscribe"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="120.75" y="210.4575">uri: "Provider callback uri"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="120.75" y="225.5903">context: ""</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="104.75" y="240.7231">}</text><polygon fill="#181818" points="104.75,270.9219,94.75,274.9219,104.75,278.9219,100.75,274.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="98.75" x2="376.75" y1="274.9219" y2="274.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="110.75" y="269.856">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="123.75" y="269.856">Register - response</text><polygon fill="#181818" points="104.75,300.0547,94.75,304.0547,104.75,308.0547,100.75,304.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="98.75" x2="376.75" y1="304.0547" y2="304.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="110.75" y="298.9888">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="123.75" y="298.9888">TopicManagementCB (action, payload)</text><path d="M98.75,317.0547 L98.75,538.0547 L334.75,538.0547 L334.75,327.0547 L324.75,317.0547 L98.75,317.0547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M324.75,317.0547 L324.75,327.0547 L334.75,327.0547 L324.75,317.0547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="104.75" y="334.1216">// Tells provider to start publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="104.75" y="349.2544">// entity id data on provided topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="104.75" y="364.3872">// with the given constraints.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="104.75" y="379.52"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="104.75" y="394.6528">action: PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="104.75" y="409.7856">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="120.75" y="424.9185">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="120.75" y="440.0513">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="120.75" y="455.1841">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="120.75" y="470.3169">subscription_info: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="136.75" y="485.4497">protocol, // MQTT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="136.75" y="500.5825">uri, // MQTT Broker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="120.75" y="515.7153">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="104.75" y="530.8481">}</text><polygon fill="#181818" points="426.25,561.0469,436.25,565.0469,426.25,569.0469,430.25,565.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="93.75" x2="432.25" y1="565.0469" y2="565.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="100.75" y="559.981">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="113.75" y="559.981">data</text><polygon fill="#181818" points="104.75,590.1797,94.75,594.1797,104.75,598.1797,100.75,594.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="98.75" x2="376.75" y1="594.1797" y2="594.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="110.75" y="589.1138">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="123.75" y="589.1138">TopicManagementCB (action, payload)</text><path d="M98.75,607.1797 L98.75,768.1797 L333.75,768.1797 L333.75,617.1797 L323.75,607.1797 L98.75,607.1797 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M323.75,607.1797 L323.75,617.1797 L333.75,617.1797 L323.75,607.1797 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="104.75" y="624.2466">// Tells provider to stop publishing</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="104.75" y="639.3794">// entity id data on provided topic.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="104.75" y="654.5122"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="104.75" y="669.645">action: STOP_PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="104.75" y="684.7778">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="120.75" y="699.9106">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="120.75" y="715.0435">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="120.75" y="730.1763">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="120.75" y="745.3091">subscription_info: None,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="104.75" y="760.4419">}</text><line style="stroke:#181818;stroke-width:2.0;" x1="420.25" x2="430.25" y1="789.6406" y2="799.6406"/><line style="stroke:#181818;stroke-width:2.0;" x1="420.25" x2="430.25" y1="799.6406" y2="789.6406"/><line style="stroke:#181818;stroke-width:1.0;" x1="93.75" x2="425.25" y1="794.6406" y2="794.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="100.75" y="789.5747">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="113.75" y="789.5747">data</text><line style="stroke:#181818;stroke-width:1.0;" x1="93.75" x2="135.75" y1="823.7734" y2="823.7734"/><line style="stroke:#181818;stroke-width:1.0;" x1="135.75" x2="135.75" y1="823.7734" y2="836.7734"/><line style="stroke:#181818;stroke-width:1.0;" x1="94.75" x2="135.75" y1="836.7734" y2="836.7734"/><polygon fill="#181818" points="104.75,832.7734,94.75,836.7734,104.75,840.7734,100.75,836.7734" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="100.75" y="818.7075">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="113.75" y="818.7075">Remove topic mapping</text><!--MD5=[184f39bcbd647f1beba4e2dd94a15ddd]
@startuml Managed Subscribe Provider
title Managed Subscribe Sequence from Provider's Perspective
participant "Digital Twin Provider" as DTProvider
participant Ibeji
participant Broker

autonumber

DTProvider -> Ibeji: Register - request
note right of DTProvider
// Entry that indicates to Ibeji that the Provider
// wants to utilize the Managed Subscribe Module.
{
    protocol: "grpc"
    operations: ["ManagedSubscribe"]
    uri: "Provider callback uri"
    context: ""
}
end note
Ibeji -> DTProvider: Register - response

Ibeji -> DTProvider: TopicManagementCB (action, payload)
note right of DTProvider
// Tells provider to start publishing
// entity id data on provided topic
// with the given constraints.

action: PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: {
        protocol, // MQTT
        uri, // MQTT Broker
    },
}
end note
DTProvider -> Broker: data
DTProvider <- Ibeji: TopicManagementCB (action, payload)
note right of DTProvider
// Tells provider to stop publishing
// entity id data on provided topic.

action: STOP_PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: None,
}
end note
DTProvider ->x Broker: data
DTProvider -> DTProvider: Remove topic mapping
@enduml

PlantUML version 1.2022.7(Mon Aug 22 10:01:30 PDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>