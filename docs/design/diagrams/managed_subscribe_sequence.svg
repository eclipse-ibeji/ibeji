<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1602px" preserveAspectRatio="none" style="width:1982px;height:1602px;background:#FFFFFF;" version="1.1" viewBox="0 0 1982 1602" width="1982px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="249" x="862.75" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="239" x="867.75" y="27.9951">Managed Subscribe Sequence</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="50" x2="50" y1="73.5938" y2="1567.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="542.5" x2="542.5" y1="73.5938" y2="1567.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="996" x2="996" y1="73.5938" y2="1567.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1575" x2="1575" y1="73.5938" y2="1567.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1669" x2="1669" y1="73.5938" y2="1567.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1940.5" x2="1940.5" y1="73.5938" y2="1567.5625"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="12" y="62.292">DTProvider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="5" y="1566.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="12" y="1586.5576">DTProvider</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="522.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="529.5" y="62.292">Ibeji</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="522.5" y="1566.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="529.5" y="1586.5576">Ibeji</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="198" x="897" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="904" y="62.292">ManagedSubscribeModule</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="198" x="897" y="1566.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="904" y="1586.5576">ManagedSubscribeModule</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="1522" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1529" y="62.292">DTConsumer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="106" x="1522" y="1566.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="1529" y="1586.5576">DTConsumer</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="1638" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="1645" y="62.292">Agemo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="63" x="1638" y="1566.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="1645" y="1586.5576">Agemo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="1910.5" y="42.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1917.5" y="62.292">Broker</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="1910.5" y="1566.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="1917.5" y="1586.5576">Broker</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1975.5" x="0" y="104.1602"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1975.5" y1="104.1602" y2="104.1602"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1975.5" y1="107.1602" y2="107.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="144" x="915.75" y="93.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="125" x="921.75" y="109.6606">Creation Process</text><polygon fill="#181818" points="531,143.8594,541,147.8594,531,151.8594,535,147.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="50" x2="537" y1="147.8594" y2="147.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="469" x="57" y="142.7935">1. Register (EntityAccessInfo[]) : Includes ManagedSubscribe endpointInfo</text><path d="M55,160.8594 L55,275.8594 L677,275.8594 L677,170.8594 L667,160.8594 L55,160.8594 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M667,160.8594 L667,170.8594 L677,170.8594 L667,160.8594 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="601" x="61" y="177.9263">// Entry that indicates to Ibeji that the Provider wants to utilize the Managed Subscribe Module.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="61" y="193.0591">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="77" y="208.1919">protocol: "grpc"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="77" y="223.3247">operations: ["ManagedSubscribe"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="77" y="238.4575">uri: "Provider callback uri"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="77" y="253.5903">context: ""</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="61" y="268.7231">}</text><polygon fill="#181818" points="554,298.9219,544,302.9219,554,306.9219,550,302.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="548" x2="995" y1="302.9219" y2="302.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="560" y="297.856">1a. Intercepts Register request</text><line style="stroke:#181818;stroke-width:1.0;" x1="954" x2="996" y1="332.0547" y2="332.0547"/><line style="stroke:#181818;stroke-width:1.0;" x1="954" x2="954" y1="332.0547" y2="345.0547"/><line style="stroke:#181818;stroke-width:1.0;" x1="954" x2="995" y1="345.0547" y2="345.0547"/><polygon fill="#181818" points="987,341.0547,997,345.0547,987,349.0547,991,345.0547" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="439" x="557" y="326.9888">1b. Modify ManagedSubscribe endpointInfo, Stores provider callback.</text><path d="M650,358.0547 L650,473.0547 L991,473.0547 L991,368.0547 L981,358.0547 L650,358.0547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M981,358.0547 L981,368.0547 L991,368.0547 L981,358.0547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="656" y="375.1216">// Points to the Managed Subscribe gRPC endpoint</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="656" y="390.2544">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="672" y="405.3872">protocol: "grpc"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="672" y="420.52">operations: ["ManagedSubscribe"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="672" y="435.6528">uri: "Ibeji uri"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="672" y="450.7856">context: "GetSubscriptionInfo"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="656" y="465.9185">}</text><polygon fill="#181818" points="554,496.1172,544,500.1172,554,504.1172,550,500.1172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="548" x2="995" y1="500.1172" y2="500.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310" x="560" y="495.0513">1c. Forwards Register request with modified data</text><polygon fill="#181818" points="554,525.25,544,529.25,554,533.25,550,529.25" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="548" x2="1574" y1="529.25" y2="529.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="560" y="524.1841">2. FindById(Temp)</text><polygon fill="#181818" points="1563,554.3828,1573,558.3828,1563,562.3828,1567,558.3828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="543" x2="1569" y1="558.3828" y2="558.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="461" x="550" y="553.3169">2a. Temp (EntityAccessInfo[]) : Includes ManagedSubscribe endpointInfo</text><polygon fill="#181818" points="1007,583.5156,997,587.5156,1007,591.5156,1003,587.5156" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1001" x2="1574" y1="587.5156" y2="587.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="388" x="1013" y="582.4497">2. ManagedSubscribe (entity_id, constraints {freq, acc, etc})</text><polygon fill="#181818" points="1657.5,612.6484,1667.5,616.6484,1657.5,620.6484,1661.5,616.6484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="996" x2="1663.5" y1="616.6484" y2="616.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="1003" y="611.5825">3. Create topic</text><polygon fill="#181818" points="1007,641.7813,997,645.7813,1007,649.7813,1003,645.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1001" x2="1668.5" y1="645.7813" y2="645.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="1013" y="640.7153">3a. SubInfo (dyn topic, broker endpoint info)</text><line style="stroke:#181818;stroke-width:1.0;" x1="996" x2="1038" y1="674.9141" y2="674.9141"/><line style="stroke:#181818;stroke-width:1.0;" x1="1038" x2="1038" y1="674.9141" y2="687.9141"/><line style="stroke:#181818;stroke-width:1.0;" x1="997" x2="1038" y1="687.9141" y2="687.9141"/><polygon fill="#181818" points="1007,683.9141,997,687.9141,1007,691.9141,1003,687.9141" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="565" x="1003" y="669.8481">4. Store Map(entity_id, topicMetadata (subInfo, constraints, management_cb_endpoint))</text><polygon fill="#181818" points="1563,713.0469,1573,717.0469,1563,721.0469,1567,717.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="996" x2="1569" y1="717.0469" y2="717.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="1003" y="711.981">5. SubInfo (dyn topic, broker endpoint info)</text><polygon fill="#181818" points="1928.5,742.1797,1938.5,746.1797,1928.5,750.1797,1932.5,746.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1575" x2="1934.5" y1="746.1797" y2="746.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="1582" y="741.1138">6. Subscribe (SubInfo.topic)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1975.5" x="0" y="774.7461"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1975.5" y1="774.7461" y2="774.7461"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1975.5" y1="777.7461" y2="777.7461"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="179" x="898.25" y="764.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="160" x="904.25" y="780.2466">Management Process</text><polygon fill="#181818" points="1928.5,814.4453,1938.5,818.4453,1928.5,822.4453,1932.5,818.4453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1575" x2="1934.5" y1="818.4453" y2="818.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="1582" y="813.3794">7. Subscribe (SubInfo.topic)</text><polygon fill="#181818" points="1680.5,843.5781,1670.5,847.5781,1680.5,851.5781,1676.5,847.5781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1674.5" x2="1939.5" y1="847.5781" y2="847.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="1686.5" y="842.5122">8. Sub notification for SubInfo.topic</text><polygon fill="#181818" points="1007,872.7109,997,876.7109,1007,880.7109,1003,876.7109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1001" x2="1668.5" y1="876.7109" y2="876.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="1013" y="871.645">8a. TopicManagementCB(dyn_topic, action)</text><polygon fill="#181818" points="61,901.8438,51,905.8438,61,909.8438,57,905.8438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="55" x2="995" y1="905.8438" y2="905.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="443" x="67" y="900.7778">5. TopicManagementCB(action, payload) : management_cb_endpoint</text><path d="M783,918.8438 L783,1079.8438 L991,1079.8438 L991,928.8438 L981,918.8438 L783,918.8438 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M981,918.8438 L981,928.8438 L991,928.8438 L981,918.8438 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="789" y="935.9106">action: START_PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="789" y="951.0435">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="805" y="966.1763">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="805" y="981.3091">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="805" y="996.4419">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="805" y="1011.5747">subscription_info: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="821" y="1026.7075">protocol, // MQTT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="821" y="1041.8403">uri, // MQTT Broker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="805" y="1056.9731">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="789" y="1072.106">}</text><polygon fill="#181818" points="1928.5,1102.3047,1938.5,1106.3047,1928.5,1110.3047,1932.5,1106.3047" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="50" x2="1934.5" y1="1106.3047" y2="1106.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="57" y="1101.2388">data</text><polygon fill="#181818" points="1586,1131.4375,1576,1135.4375,1586,1139.4375,1582,1135.4375" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1580" x2="1939.5" y1="1135.4375" y2="1135.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="1592" y="1130.3716">data</text><polygon fill="#181818" points="1928.5,1160.5703,1938.5,1164.5703,1928.5,1168.5703,1932.5,1164.5703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1575" x2="1934.5" y1="1164.5703" y2="1164.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1582" y="1159.5044">9. Unsubscribe (SubInfo.topic)</text><line style="stroke:#181818;stroke-width:2.0;" x1="1582" x2="1592" y1="1188.7031" y2="1198.7031"/><line style="stroke:#181818;stroke-width:2.0;" x1="1582" x2="1592" y1="1198.7031" y2="1188.7031"/><line style="stroke:#181818;stroke-width:1.0;" x1="1587" x2="1939.5" y1="1193.7031" y2="1193.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="1592" y="1188.6372">data</text><polygon fill="#181818" points="1680.5,1218.8359,1670.5,1222.8359,1680.5,1226.8359,1676.5,1222.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1674.5" x2="1939.5" y1="1222.8359" y2="1222.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="1686.5" y="1217.77">10. Unsub notification for SubInfo.topic</text><polygon fill="#181818" points="1007,1247.9688,997,1251.9688,1007,1255.9688,1003,1251.9688" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1001" x2="1668.5" y1="1251.9688" y2="1251.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="1013" y="1246.9028">10a. TopicManagementCB(dyn_topic, action)</text><polygon fill="#181818" points="61,1277.1016,51,1281.1016,61,1285.1016,57,1281.1016" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="55" x2="995" y1="1281.1016" y2="1281.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="67" y="1276.0356">10b. TopicManagementCB(action, payload)</text><path d="M783,1294.1016 L783,1409.1016 L991,1409.1016 L991,1304.1016 L981,1294.1016 L783,1294.1016 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M981,1294.1016 L981,1304.1016 L991,1304.1016 L981,1294.1016 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="789" y="1311.1685">action: STOP_PUBLISH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="789" y="1326.3013">payload: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="805" y="1341.4341">entity_id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="805" y="1356.5669">topic,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="805" y="1371.6997">constraints, // (type, value)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="805" y="1386.8325">subscription_info: None,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="789" y="1401.9653">}</text><line style="stroke:#181818;stroke-width:2.0;" x1="1922.5" x2="1932.5" y1="1431.1641" y2="1441.1641"/><line style="stroke:#181818;stroke-width:2.0;" x1="1922.5" x2="1932.5" y1="1441.1641" y2="1431.1641"/><line style="stroke:#181818;stroke-width:1.0;" x1="50" x2="1927.5" y1="1436.1641" y2="1436.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="29" x="57" y="1431.0981">data</text><line style="stroke:#181818;stroke-width:1.0;" x1="50" x2="92" y1="1465.2969" y2="1465.2969"/><line style="stroke:#181818;stroke-width:1.0;" x1="92" x2="92" y1="1465.2969" y2="1478.2969"/><line style="stroke:#181818;stroke-width:1.0;" x1="51" x2="92" y1="1478.2969" y2="1478.2969"/><polygon fill="#181818" points="61,1474.2969,51,1478.2969,61,1482.2969,57,1478.2969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="57" y="1460.231">Remove topic mapping</text><polygon fill="#181818" points="1657.5,1503.4297,1667.5,1507.4297,1657.5,1511.4297,1661.5,1507.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="996" x2="1663.5" y1="1507.4297" y2="1507.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="1003" y="1502.3638">DeleteTopic(SubInfo.topic)</text><line style="stroke:#181818;stroke-width:1.0;" x1="996" x2="1038" y1="1536.5625" y2="1536.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="1038" x2="1038" y1="1536.5625" y2="1549.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="997" x2="1038" y1="1549.5625" y2="1549.5625"/><polygon fill="#181818" points="1007,1545.5625,997,1549.5625,1007,1553.5625,1003,1549.5625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="1003" y="1531.4966">Remove topic mapping</text><!--MD5=[4453916eb852ef44ca935f0bbccea74e]
@startuml Managed Subscribe Sample
title Managed Subscribe Sequence
participant DTProvider
participant Ibeji
participant ManagedSubscribeModule
participant DTConsumer
participant Agemo
participant Broker

== Creation Process ==

Ibeji <- DTProvider: 1. Register (EntityAccessInfo[]) : Includes ManagedSubscribe endpointInfo
note right of DTProvider
// Entry that indicates to Ibeji that the Provider wants to utilize the Managed Subscribe Module.
{
    protocol: "grpc"
    operations: ["ManagedSubscribe"]
    uri: "Provider callback uri"
    context: ""
}
end note
Ibeji <- ManagedSubscribeModule: 1a. Intercepts Register request
ManagedSubscribeModule <- ManagedSubscribeModule: 1b. Modify ManagedSubscribe endpointInfo, Stores provider callback.
note left of ManagedSubscribeModule
// Points to the Managed Subscribe gRPC endpoint
{
    protocol: "grpc"
    operations: ["ManagedSubscribe"]
    uri: "Ibeji uri"
    context: "GetSubscriptionInfo"
}
end note
Ibeji <- ManagedSubscribeModule: 1c. Forwards Register request with modified data
DTConsumer -> Ibeji: 2. FindById(Temp)
DTConsumer <- Ibeji: 2a. Temp (EntityAccessInfo[]) : Includes ManagedSubscribe endpointInfo
DTConsumer -> ManagedSubscribeModule: 2. ManagedSubscribe (entity_id, constraints {freq, acc, etc})
ManagedSubscribeModule -> Agemo: 3. Create topic
Agemo -> ManagedSubscribeModule: 3a. SubInfo (dyn topic, broker endpoint info)
ManagedSubscribeModule -> ManagedSubscribeModule: 4. Store Map(entity_id, topicMetadata (subInfo, constraints, management_cb_endpoint))
ManagedSubscribeModule -> DTConsumer: 5. SubInfo (dyn topic, broker endpoint info)
DTConsumer -> Broker: 6. Subscribe (SubInfo.topic)

== Management Process ==
DTConsumer -> Broker: 7. Subscribe (SubInfo.topic)
Broker -> Agemo: 8. Sub notification for SubInfo.topic
Agemo -> ManagedSubscribeModule: 8a. TopicManagementCB(dyn_topic, action)
ManagedSubscribeModule -> DTProvider: 5. TopicManagementCB(action, payload) : management_cb_endpoint
note left of ManagedSubscribeModule
action: START_PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: {
        protocol, // MQTT
        uri, // MQTT Broker
    },
}
end note
DTProvider -> Broker: data
DTConsumer <- Broker : data
DTConsumer -> Broker: 9. Unsubscribe (SubInfo.topic)
DTConsumer x<- Broker: data
Broker -> Agemo: 10. Unsub notification for SubInfo.topic
Agemo -> ManagedSubscribeModule: 10a. TopicManagementCB(dyn_topic, action)
DTProvider <- ManagedSubscribeModule: 10b. TopicManagementCB(action, payload) 
note left of ManagedSubscribeModule
action: STOP_PUBLISH
payload: {
    entity_id,
    topic,
    constraints, // (type, value)
    subscription_info: None,
}
end note
DTProvider ->x Broker: data
DTProvider -> DTProvider: Remove topic mapping
ManagedSubscribeModule -> Agemo: DeleteTopic(SubInfo.topic)
ManagedSubscribeModule -> ManagedSubscribeModule: Remove topic mapping
@enduml

PlantUML version 1.2022.7(Mon Aug 22 10:01:30 PDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>